@tailwind base;
@tailwind components;
@tailwind utilities;

/* ══════════════════════════════════════════════
   LIQUID GLASS THEME TOKENS
   ══════════════════════════════════════════════ */

:root,
.light {
  /* ── Background ── */
  --bg-primary: #F8F9FC;
  --bg-secondary: #EEF2F7;

  /* ── Glass System ── */
  --glass-surface: rgba(255, 255, 255, 0.65);
  --glass-elevated: rgba(255, 255, 255, 0.85);
  --glass-edge: rgba(255, 255, 255, 0.6);
  --glass-blur: 20px;
  --glass-blur-heavy: 32px;

  /* ── Borders & Shadows ── */
  --border-subtle: rgba(71, 85, 105, 0.08);
  /* Softer border */
  --glass-shadow: rgba(17, 24, 39, 0.04);
  --glass-shadow-lg: rgba(17, 24, 39, 0.08);
  /* Lighter shadow */

  /* ── Accents ── */
  --accent-primary: #6366F1;
  /* Indigo-500, slight purple shift for premium feel */
  --accent-primary-dark: #4F46E5;
  --accent-primary-light: #818CF8;

  --accent-secondary: #A855F7;
  /* Purple-500 */
  --accent-secondary-dark: #9333EA;

  --soft-highlight: #FDE68A;

  /* ── Text ── */
  --text-primary: #1E293B;
  /* Slate-800 */
  --text-secondary: #475569;
  /* Slate-600 */
  --text-muted: #94A3B8;
  /* Slate-400 */
  --text-inverse: #FFFFFF;

  /* ── Glows ── */
  --hover-glow: rgba(99, 102, 241, 0.12);
  --active-glow: rgba(168, 85, 247, 0.12);
  --focus-ring: rgba(99, 102, 241, 0.3);

  /* ── Effects ── */
  --specular-gradient: linear-gradient(120deg,
      rgba(255, 255, 255, 0) 20%,
      rgba(255, 255, 255, 0.4) 50%,
      rgba(255, 255, 255, 0) 80%);
  --noise-opacity: 0.015;
  /* Barely visible texture */
  --refraction-strength: 1.5px;

  /* ── Toast ── */
  --toast-bg: rgba(255, 255, 255, 0.95);
  --toast-text: #1E293B;
}

.dark {
  /* ── Background ── */
  --bg-primary: #0F1117;
  /* Deep blue-black */
  --bg-secondary: #161B28;

  /* ── Glass System ── */
  --glass-surface: rgba(20, 25, 38, 0.6);
  --glass-elevated: rgba(30, 41, 59, 0.7);
  --glass-edge: rgba(255, 255, 255, 0.1);
  --glass-blur: 24px;
  --glass-blur-heavy: 40px;

  /* ── Borders & Shadows ── */
  --border-subtle: rgba(255, 255, 255, 0.08);
  --glass-shadow: rgba(0, 0, 0, 0.4);
  --glass-shadow-lg: rgba(0, 0, 0, 0.6);

  /* ── Accents ── */
  --accent-primary: #818CF8;
  --accent-primary-dark: #6366F1;
  --accent-primary-light: #A5B4FC;

  --accent-secondary: #C084FC;
  --accent-secondary-dark: #A855F7;

  --soft-highlight: #FCD34D;

  /* ── Text ── */
  --text-primary: #F1F5F9;
  --text-secondary: #94A3B8;
  --text-muted: #64748B;
  --text-inverse: #0F1117;

  /* ── Glows ── */
  --hover-glow: rgba(129, 140, 248, 0.15);
  --active-glow: rgba(192, 132, 252, 0.15);
  --focus-ring: rgba(129, 140, 248, 0.35);

  /* ── Effects ── */
  --specular-gradient: linear-gradient(120deg,
      rgba(255, 255, 255, 0) 20%,
      rgba(255, 255, 255, 0.08) 50%,
      rgba(255, 255, 255, 0) 80%);
  --noise-opacity: 0.03;
  --refraction-strength: 1px;

  /* ── Toast ── */
  --toast-bg: rgba(30, 41, 59, 0.95);
  --toast-text: #F1F5F9;
}

/* ══════════════════════════════════════════════
   THEME MORPH TRANSITION
   ══════════════════════════════════════════════ */
.theme-transitioning,
.theme-transitioning * {
  transition: background-color 420ms cubic-bezier(0.22, 1, 0.36, 1),
    color 420ms cubic-bezier(0.22, 1, 0.36, 1),
    border-color 420ms cubic-bezier(0.22, 1, 0.36, 1),
    box-shadow 420ms cubic-bezier(0.22, 1, 0.36, 1),
    backdrop-filter 420ms cubic-bezier(0.22, 1, 0.36, 1) !important;
}

@layer base {
  * {
    border-color: var(--border-subtle);
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
    -webkit-text-size-adjust: 100%;
  }

  body {
    @apply font-sans antialiased;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-feature-settings: "rlig" 1, "calt" 1;
    font-size: 16px;
    line-height: 1.6;
    min-height: 100vh;
    min-height: 100dvh;
    overflow-x: hidden;
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    /* Slightly wider for better usability */
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: var(--border-subtle);
    border-radius: 4px;
    border: 2px solid transparent;
    /* creates padding around thumb */
    background-clip: content-box;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
    border: 2px solid transparent;
    background-clip: content-box;
  }

  /* Touch target enforcement */
  button,
  a,
  [role="button"],
  [role="tab"],
  input,
  select,
  textarea {
    min-height: 0;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {

    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }

    .liquid-glass::before,
    .liquid-glass::after {
      display: none !important;
    }
  }
}

@layer components {

  /* ══════════════════════════════════════════════
     LIQUID GLASS MATERIAL
     ══════════════════════════════════════════════ */

  .liquid-glass {
    position: relative;
    isolation: isolate;
    background: var(--glass-surface);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-edge);
    box-shadow: 0 4px 24px var(--glass-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    overflow: hidden;
    transition: all 400ms cubic-bezier(0.2, 0.8, 0.2, 1);
  }

  .liquid-glass::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--specular-gradient);
    background-size: 200% 100%;
    pointer-events: none;
    opacity: 0;
    transition: opacity 500ms ease;
    z-index: 1;
  }

  .liquid-glass:hover::before {
    opacity: 1;
    animation: lightSweep 2.5s ease-in-out;
  }

  .liquid-glass::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size: 100px 100px;
    opacity: var(--noise-opacity);
    pointer-events: none;
    z-index: 0;
    mix-blend-mode: overlay;
  }

  .liquid-glass-elevated {
    position: relative;
    isolation: isolate;
    background: var(--glass-elevated);
    backdrop-filter: blur(var(--glass-blur-heavy));
    -webkit-backdrop-filter: blur(var(--glass-blur-heavy));
    border: 1px solid var(--glass-edge);
    box-shadow: 0 12px 40px var(--glass-shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.3);
    overflow: hidden;
  }

  .liquid-glass-elevated::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size: 100px 100px;
    opacity: var(--noise-opacity);
    pointer-events: none;
    z-index: 0;
    mix-blend-mode: overlay;
  }

  .liquid-glass-header {
    background: var(--glass-elevated);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border-bottom: 1px solid var(--glass-edge);
    box-shadow: 0 4px 20px var(--glass-shadow);
    isolation: isolate;
    z-index: 50;
  }

  /* ── Buttons — proper proportions ────────────── */
  .btn-liquid {
    @apply px-5 py-2.5 rounded-glass font-medium text-sm;
    position: relative;
    isolation: isolate;
    overflow: hidden;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 40px;
    min-width: max-content;
    background: var(--glass-surface);
    border: 1px solid var(--glass-edge);
    color: var(--text-secondary);
    box-shadow: 0 2px 8px var(--glass-shadow);
    transition: all 300ms cubic-bezier(0.2, 0.8, 0.2, 1);
    cursor: pointer;
    white-space: nowrap;
    gap: 8px;
    line-height: 1.4;
    letter-spacing: -0.01em;
  }

  .btn-liquid::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--specular-gradient);
    background-size: 200% 100%;
    opacity: 0;
    transition: opacity 300ms;
    pointer-events: none;
    z-index: -1;
  }

  .btn-liquid:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px var(--glass-shadow), 0 0 15px var(--hover-glow);
    color: var(--text-primary);
    background: var(--glass-elevated);
    border-color: var(--accent-primary-light);
  }

  .btn-liquid:hover::before {
    opacity: 0.6;
    animation: lightSweep 2s ease-in-out;
  }

  .btn-liquid:active {
    transform: scale(0.98) translateY(0);
    box-shadow: 0 1px 4px var(--glass-shadow);
  }

  .btn-liquid:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--focus-ring), 0 0 10px var(--hover-glow);
    border-color: var(--accent-primary);
  }

  .btn-liquid:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .btn-primary-liquid {
    @apply px-5 py-2.5 rounded-glass font-semibold text-sm;
    position: relative;
    isolation: isolate;
    overflow: hidden;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 40px;
    min-width: max-content;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #FFFFFF;
    box-shadow: 0 4px 12px var(--hover-glow);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    transition: all 300ms cubic-bezier(0.2, 0.8, 0.2, 1);
    cursor: pointer;
    white-space: nowrap;
    gap: 8px;
    line-height: 1.4;
    letter-spacing: -0.01em;
  }

  .btn-primary-liquid::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(115deg, transparent 30%, rgba(255, 255, 255, 0.4) 50%, transparent 70%);
    background-size: 200% 100%;
    opacity: 0;
    pointer-events: none;
    transition: opacity 300ms;
    z-index: 1;
  }

  .btn-primary-liquid:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px var(--hover-glow), 0 0 25px var(--active-glow);
    filter: brightness(1.05);
  }

  .btn-primary-liquid:hover::before {
    opacity: 1;
    animation: lightSweep 2s ease-in-out;
  }

  .btn-primary-liquid:active {
    transform: scale(0.97) translateY(0);
    transition-duration: 100ms;
    filter: brightness(0.95);
  }

  .btn-primary-liquid:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--focus-ring), 0 4px 20px var(--hover-glow);
  }

  .btn-primary-liquid:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
    filter: grayscale(0.5);
  }

  /* ── Form Elements — proper sizing ───────────── */
  .input-field {
    @apply w-full px-4 py-3 rounded-glass text-sm;
    min-height: 44px;
    background: var(--glass-surface);
    border: 1px solid var(--border-subtle);
    color: var(--text-primary);
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
    transition: all 250ms cubic-bezier(0.2, 0.8, 0.2, 1);
    line-height: 1.5;
  }

  .input-field::placeholder {
    color: var(--text-muted);
  }

  .input-field:focus {
    outline: none;
    border-color: var(--accent-primary-light);
    background: var(--glass-elevated);
    box-shadow: 0 0 0 3px var(--focus-ring), 0 4px 12px var(--hover-glow);
    transform: scale(1.005);
  }

  select.input-field option {
    background: var(--bg-primary);
    color: var(--text-primary);
  }

  input[type="checkbox"] {
    @apply rounded;
    accent-color: var(--accent-primary);
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  input[type="range"] {
    accent-color: var(--accent-primary);
    height: 6px;
    cursor: pointer;
  }

  /* ── Cards — responsive padding ─────────────── */
  .card {
    @apply rounded-glass;
    padding: 16px;
    position: relative;
    isolation: isolate;
    overflow: hidden;
    background: var(--glass-elevated);
    /* Slightly more elevated for cards */
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-edge);
    box-shadow: 0 4px 20px var(--glass-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.4);
    transition: all 400ms cubic-bezier(0.2, 0.8, 0.2, 1);
  }

  @media (min-width: 640px) {
    .card {
      padding: 24px;
    }
  }

  @media (min-width: 1024px) {
    .card {
      padding: 32px;
    }
  }

  .card::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size: 100px 100px;
    opacity: var(--noise-opacity);
    pointer-events: none;
    z-index: 0;
    mix-blend-mode: overlay;
  }

  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px var(--glass-shadow-lg), 0 0 30px var(--glass-shadow);
  }

  .card:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--focus-ring), 0 8px 32px var(--hover-glow);
  }

  /* ── Chat Messages — responsive widths ──────── */
  .message-user {
    @apply rounded-glass rounded-br-md;
    padding: 12px 16px;
    max-width: 90%;
    margin-left: auto;
    position: relative;
    background: var(--glass-elevated);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid var(--glass-edge);
    color: var(--text-primary);
    box-shadow: 0 6px 24px var(--glass-shadow);
    overflow: hidden;
    word-break: break-word;
  }

  @media (min-width: 640px) {
    .message-user {
      max-width: 80%;
      padding: 14px 18px;
    }
  }

  @media (min-width: 1024px) {
    .message-user {
      max-width: 75%;
      padding: 14px 20px;
    }
  }

  .message-user::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--specular-gradient);
    background-size: 200% 100%;
    opacity: 0.3;
    pointer-events: none;
    animation: specularShift 2.4s ease-in-out infinite;
  }

  .message-assistant {
    @apply rounded-glass rounded-bl-md;
    padding: 12px 16px;
    max-width: 90%;
    margin-right: auto;
    position: relative;
    background: var(--glass-surface);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-edge);
    color: var(--text-primary);
    box-shadow: 0 4px 16px var(--glass-shadow);
    overflow: hidden;
    word-break: break-word;
  }

  @media (min-width: 640px) {
    .message-assistant {
      max-width: 82%;
      padding: 14px 18px;
    }
  }

  @media (min-width: 1024px) {
    .message-assistant {
      max-width: 78%;
      padding: 14px 20px;
    }
  }

  .message-assistant::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size: 128px 128px;
    opacity: var(--noise-opacity);
    pointer-events: none;
    z-index: 1;
    mix-blend-mode: overlay;
  }

  .message-assistant.has-references {
    border-left: 3px solid var(--accent-primary);
  }

  /* ── Sidebar Restore ────────────────────────── */
  .sidebar-restore {
    @apply fixed z-50 flex items-center justify-center;
    width: 44px;
    height: 44px;
    left: 12px;
    top: 16px;
    background: var(--glass-elevated);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-edge);
    border-radius: 50%;
    box-shadow: 0 4px 16px var(--glass-shadow);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 180ms cubic-bezier(0.22, 1, 0.36, 1);
    animation: glassPulse 3s ease-in-out infinite;
  }

  .sidebar-restore:hover {
    box-shadow: 0 6px 24px var(--hover-glow);
    color: var(--accent-primary);
    transform: scale(1.08);
    animation: none;
  }

  .sidebar-restore:active {
    transform: scale(0.92);
    transition-duration: 80ms;
  }

  .sidebar-restore:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--focus-ring);
  }

  /* ── Theme Toggle ────────────────────────── */
  .theme-toggle {
    @apply relative flex items-center rounded-pill cursor-pointer;
    width: 56px;
    height: 30px;
    flex-shrink: 0;
    background: var(--glass-surface);
    border: 1px solid var(--glass-edge);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    transition: all 320ms cubic-bezier(0.22, 1, 0.36, 1);
    overflow: hidden;
  }

  .theme-toggle::before {
    content: '';
    position: absolute;
    width: 24px;
    height: 24px;
    left: 3px;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius: 50%;
    box-shadow: 0 2px 8px var(--hover-glow);
    transition: all 320ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  .theme-toggle.dark::before {
    left: calc(100% - 27px);
  }

  .theme-toggle:hover::before {
    box-shadow: 0 2px 12px var(--hover-glow), 0 0 16px var(--active-glow);
  }

  /* ── Mobile nav touch target ─────────────────── */
  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    min-height: 44px;
    border-radius: 10px;
    transition: all 180ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  .nav-item:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--focus-ring);
    background: var(--hover-glow);
  }

  @media (min-width: 1024px) {
    .nav-item {
      padding: 8px 14px;
      min-height: 40px;
    }
  }
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }

  .z-content {
    position: relative;
    z-index: 2;
  }

  /* Touch-friendly minimum tap target */
  .touch-target {
    min-width: 44px;
    min-height: 44px;
  }

  /* Safe area support for mobile */
  .pb-safe {
    padding-bottom: max(20px, env(safe-area-inset-bottom));
  }
}