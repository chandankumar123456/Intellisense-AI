@tailwind base;
@tailwind components;
@tailwind utilities;

/* ══════════════════════════════════════════════
   LIQUID GLASS THEME TOKENS
   ══════════════════════════════════════════════ */

:root,
.light {
  --bg-primary: #F6F7FB;
  --bg-secondary: #ECEFF5;
  --glass-surface: rgba(255, 255, 255, 0.72);
  --glass-elevated: rgba(255, 255, 255, 0.88);
  --glass-edge: rgba(255, 255, 255, 0.96);
  --glass-blur: 12px;
  --glass-blur-heavy: 20px;

  --border-subtle: rgba(15, 23, 42, 0.06);
  --glass-shadow: rgba(12, 18, 28, 0.06);
  --glass-shadow-lg: rgba(12, 18, 28, 0.10);

  --accent-primary: #7A8CFF;
  --accent-primary-dark: #6272E8;
  --accent-primary-light: #99A8FF;
  --accent-secondary: #B38CFF;
  --accent-secondary-dark: #9B72E8;
  --soft-highlight: #FFD6A5;

  --text-primary: #0F172A;
  --text-secondary: #475569;
  --text-muted: #7B8794;
  --text-inverse: #FFFFFF;

  --hover-glow: rgba(122, 140, 255, 0.18);
  --active-glow: rgba(179, 140, 255, 0.16);
  --focus-ring: rgba(122, 140, 255, 0.25);

  /* Specular & noise */
  --specular-gradient: linear-gradient(115deg,
      transparent 30%,
      rgba(255, 255, 255, 0.4) 45%,
      rgba(255, 255, 255, 0.15) 55%,
      transparent 70%);
  --noise-opacity: 0.025;
  --refraction-strength: 1px;

  /* Toast */
  --toast-bg: rgba(255, 255, 255, 0.9);
  --toast-text: #0F172A;
}

.dark {
  --bg-primary: #0E1016;
  --bg-secondary: #141824;
  --glass-surface: rgba(255, 255, 255, 0.05);
  --glass-elevated: rgba(255, 255, 255, 0.08);
  --glass-edge: rgba(255, 255, 255, 0.12);
  --glass-blur: 14px;
  --glass-blur-heavy: 24px;

  --border-subtle: rgba(255, 255, 255, 0.06);
  --glass-shadow: rgba(0, 0, 0, 0.3);
  --glass-shadow-lg: rgba(0, 0, 0, 0.5);

  --accent-primary: #8C9BFF;
  --accent-primary-dark: #7A8AEE;
  --accent-primary-light: #A3B0FF;
  --accent-secondary: #C49BFF;
  --accent-secondary-dark: #B38AEE;
  --soft-highlight: #FFC98F;

  --text-primary: #EAF0FF;
  --text-secondary: #AAB4C9;
  --text-muted: #6B7487;
  --text-inverse: #0E1016;

  --hover-glow: rgba(140, 155, 255, 0.24);
  --active-glow: rgba(196, 155, 255, 0.20);
  --focus-ring: rgba(140, 155, 255, 0.3);

  --specular-gradient: linear-gradient(115deg,
      transparent 30%,
      rgba(255, 255, 255, 0.06) 45%,
      rgba(255, 255, 255, 0.02) 55%,
      transparent 70%);
  --noise-opacity: 0.04;
  --refraction-strength: 0.5px;

  --toast-bg: rgba(20, 24, 36, 0.92);
  --toast-text: #EAF0FF;
}

/* ══════════════════════════════════════════════
   THEME MORPH TRANSITION
   ══════════════════════════════════════════════ */
.theme-transitioning,
.theme-transitioning * {
  transition: background-color 420ms cubic-bezier(0.22, 1, 0.36, 1),
    color 420ms cubic-bezier(0.22, 1, 0.36, 1),
    border-color 420ms cubic-bezier(0.22, 1, 0.36, 1),
    box-shadow 420ms cubic-bezier(0.22, 1, 0.36, 1),
    backdrop-filter 420ms cubic-bezier(0.22, 1, 0.36, 1) !important;
}

@layer base {
  * {
    border-color: var(--border-subtle);
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
    -webkit-text-size-adjust: 100%;
  }

  body {
    @apply font-sans antialiased;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-feature-settings: "rlig" 1, "calt" 1;
    font-size: 16px;
    line-height: 1.6;
    min-height: 100vh;
    min-height: 100dvh;
    overflow-x: hidden;
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: var(--border-subtle);
    border-radius: 999px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
  }

  /* Touch target enforcement */
  button,
  a,
  [role="button"],
  [role="tab"],
  input,
  select,
  textarea {
    min-height: 0;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {

    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }

    .liquid-glass::before,
    .liquid-glass::after {
      display: none !important;
    }
  }
}

@layer components {

  /* ══════════════════════════════════════════════
     LIQUID GLASS MATERIAL
     ══════════════════════════════════════════════ */

  .liquid-glass {
    position: relative;
    background: var(--glass-surface);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-edge);
    box-shadow: 0 8px 32px var(--glass-shadow), inset 0 1px 0 var(--glass-edge);
    overflow: hidden;
  }

  .liquid-glass::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--specular-gradient);
    background-size: 200% 100%;
    pointer-events: none;
    opacity: 0;
    transition: opacity 320ms cubic-bezier(0.22, 1, 0.36, 1);
    z-index: 1;
  }

  .liquid-glass:hover::before {
    opacity: 1;
    animation: lightSweep 1.8s ease-in-out;
  }

  .liquid-glass::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size: 128px 128px;
    opacity: var(--noise-opacity);
    pointer-events: none;
    z-index: 1;
    mix-blend-mode: overlay;
  }

  .liquid-glass-elevated {
    position: relative;
    background: var(--glass-elevated);
    backdrop-filter: blur(var(--glass-blur-heavy));
    -webkit-backdrop-filter: blur(var(--glass-blur-heavy));
    border: 1px solid var(--glass-edge);
    box-shadow: 0 16px 48px var(--glass-shadow-lg), inset 0 1px 0 var(--glass-edge);
    overflow: hidden;
  }

  .liquid-glass-elevated::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size: 128px 128px;
    opacity: var(--noise-opacity);
    pointer-events: none;
    z-index: 1;
    mix-blend-mode: overlay;
  }

  .liquid-glass-header {
    background: var(--glass-elevated);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border-bottom: 1px solid var(--border-subtle);
    box-shadow: 0 1px 4px var(--glass-shadow);
  }

  /* ── Buttons — proper proportions ────────────── */
  .btn-liquid {
    @apply px-5 py-2.5 rounded-glass font-medium text-sm;
    position: relative;
    overflow: hidden;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 40px;
    min-width: max-content;
    background: var(--glass-surface);
    border: 1px solid var(--glass-edge);
    color: var(--text-secondary);
    box-shadow: 0 4px 16px var(--glass-shadow);
    transition: all 180ms cubic-bezier(0.22, 1, 0.36, 1);
    cursor: pointer;
    white-space: nowrap;
    gap: 8px;
    line-height: 1.4;
  }

  .btn-liquid::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--specular-gradient);
    background-size: 200% 100%;
    opacity: 0;
    transition: opacity 180ms;
    pointer-events: none;
  }

  .btn-liquid:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 24px var(--glass-shadow), 0 0 20px var(--hover-glow);
    color: var(--text-primary);
  }

  .btn-liquid:hover::before {
    opacity: 1;
    animation: lightSweep 1.8s ease-in-out;
  }

  .btn-liquid:active {
    transform: scale(0.985) translateY(0);
    box-shadow: 0 2px 8px var(--glass-shadow);
    transition-duration: 80ms;
  }

  .btn-liquid:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--focus-ring), 0 0 16px var(--hover-glow);
  }

  .btn-liquid:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .btn-primary-liquid {
    @apply px-5 py-2.5 rounded-glass font-semibold text-sm;
    position: relative;
    overflow: hidden;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 40px;
    min-width: max-content;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border: none;
    color: #FFFFFF;
    box-shadow: 0 4px 20px var(--hover-glow);
    transition: all 180ms cubic-bezier(0.22, 1, 0.36, 1);
    cursor: pointer;
    white-space: nowrap;
    gap: 8px;
    line-height: 1.4;
  }

  .btn-primary-liquid::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(115deg, transparent 30%, rgba(255, 255, 255, 0.25) 50%, transparent 70%);
    background-size: 200% 100%;
    opacity: 0;
    pointer-events: none;
    transition: opacity 180ms;
  }

  .btn-primary-liquid:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 28px var(--hover-glow), 0 0 24px var(--active-glow);
  }

  .btn-primary-liquid:hover::before {
    opacity: 1;
    animation: lightSweep 1.8s ease-in-out;
  }

  .btn-primary-liquid:active {
    transform: scale(0.985) translateY(0);
    transition-duration: 80ms;
  }

  .btn-primary-liquid:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--focus-ring), 0 4px 20px var(--hover-glow);
  }

  .btn-primary-liquid:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  /* ── Form Elements — proper sizing ───────────── */
  .input-field {
    @apply w-full px-4 py-3 rounded-glass text-sm;
    min-height: 44px;
    background: var(--glass-surface);
    border: 1px solid var(--border-subtle);
    color: var(--text-primary);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.03);
    transition: all 200ms cubic-bezier(0.22, 1, 0.36, 1);
    line-height: 1.5;
  }

  .input-field::placeholder {
    color: var(--text-muted);
  }

  .input-field:focus {
    outline: none;
    border-color: var(--accent-primary);
    background: var(--glass-elevated);
    box-shadow: 0 0 0 3px var(--focus-ring), 0 6px 20px var(--hover-glow);
    transform: scale(1.003);
  }

  select.input-field option {
    background: var(--bg-primary);
    color: var(--text-primary);
  }

  input[type="checkbox"] {
    @apply rounded;
    accent-color: var(--accent-primary);
    width: 18px;
    height: 18px;
  }

  input[type="range"] {
    accent-color: var(--accent-primary);
    height: 6px;
  }

  /* ── Cards — responsive padding ─────────────── */
  .card {
    @apply rounded-glass;
    padding: 16px;
    position: relative;
    overflow: hidden;
    background: var(--glass-surface);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-edge);
    box-shadow: 0 8px 32px var(--glass-shadow), inset 0 1px 0 var(--glass-edge);
    transition: all 180ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  @media (min-width: 640px) {
    .card {
      padding: 20px;
    }
  }

  @media (min-width: 1024px) {
    .card {
      padding: 24px;
    }
  }

  .card::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size: 128px 128px;
    opacity: var(--noise-opacity);
    pointer-events: none;
    z-index: 1;
    mix-blend-mode: overlay;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px var(--glass-shadow-lg), 0 0 24px var(--hover-glow);
  }

  /* ── Chat Messages — responsive widths ──────── */
  .message-user {
    @apply rounded-glass rounded-br-md;
    padding: 12px 16px;
    max-width: 90%;
    margin-left: auto;
    position: relative;
    background: var(--glass-elevated);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid var(--glass-edge);
    color: var(--text-primary);
    box-shadow: 0 6px 24px var(--glass-shadow);
    overflow: hidden;
    word-break: break-word;
  }

  @media (min-width: 640px) {
    .message-user {
      max-width: 80%;
      padding: 14px 18px;
    }
  }

  @media (min-width: 1024px) {
    .message-user {
      max-width: 75%;
      padding: 14px 20px;
    }
  }

  .message-user::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--specular-gradient);
    background-size: 200% 100%;
    opacity: 0.3;
    pointer-events: none;
    animation: specularShift 2.4s ease-in-out infinite;
  }

  .message-assistant {
    @apply rounded-glass rounded-bl-md;
    padding: 12px 16px;
    max-width: 90%;
    margin-right: auto;
    position: relative;
    background: var(--glass-surface);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-edge);
    color: var(--text-primary);
    box-shadow: 0 4px 16px var(--glass-shadow);
    overflow: hidden;
    word-break: break-word;
  }

  @media (min-width: 640px) {
    .message-assistant {
      max-width: 82%;
      padding: 14px 18px;
    }
  }

  @media (min-width: 1024px) {
    .message-assistant {
      max-width: 78%;
      padding: 14px 20px;
    }
  }

  .message-assistant::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size: 128px 128px;
    opacity: var(--noise-opacity);
    pointer-events: none;
    z-index: 1;
    mix-blend-mode: overlay;
  }

  .message-assistant.has-references {
    border-left: 3px solid var(--accent-primary);
  }

  /* ── Sidebar Restore ────────────────────────── */
  .sidebar-restore {
    @apply fixed z-50 flex items-center justify-center;
    width: 44px;
    height: 44px;
    left: 12px;
    top: 16px;
    background: var(--glass-elevated);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--glass-edge);
    border-radius: 50%;
    box-shadow: 0 4px 16px var(--glass-shadow);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 180ms cubic-bezier(0.22, 1, 0.36, 1);
    animation: glassPulse 3s ease-in-out infinite;
  }

  .sidebar-restore:hover {
    box-shadow: 0 6px 24px var(--hover-glow);
    color: var(--accent-primary);
    transform: scale(1.08);
    animation: none;
  }

  .sidebar-restore:active {
    transform: scale(0.92);
    transition-duration: 80ms;
  }

  .sidebar-restore:focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--focus-ring);
  }

  /* ── Theme Toggle ────────────────────────── */
  .theme-toggle {
    @apply relative flex items-center rounded-pill cursor-pointer;
    width: 56px;
    height: 30px;
    flex-shrink: 0;
    background: var(--glass-surface);
    border: 1px solid var(--glass-edge);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    transition: all 320ms cubic-bezier(0.22, 1, 0.36, 1);
    overflow: hidden;
  }

  .theme-toggle::before {
    content: '';
    position: absolute;
    width: 24px;
    height: 24px;
    left: 3px;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    border-radius: 50%;
    box-shadow: 0 2px 8px var(--hover-glow);
    transition: all 320ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  .theme-toggle.dark::before {
    left: calc(100% - 27px);
  }

  .theme-toggle:hover::before {
    box-shadow: 0 2px 12px var(--hover-glow), 0 0 16px var(--active-glow);
  }

  /* ── Mobile nav touch target ─────────────────── */
  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    min-height: 44px;
    border-radius: 10px;
    transition: all 180ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  @media (min-width: 1024px) {
    .nav-item {
      padding: 8px 14px;
      min-height: 40px;
    }
  }
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }

  .z-content {
    position: relative;
    z-index: 2;
  }

  /* Touch-friendly minimum tap target */
  .touch-target {
    min-width: 44px;
    min-height: 44px;
  }

  /* Safe area support for mobile */
  .pb-safe {
    padding-bottom: max(20px, env(safe-area-inset-bottom));
  }
}